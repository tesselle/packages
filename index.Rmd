---
title: "tesselle"
---

```{r, include=FALSE}
## Install missing packages (if any)
pkg <- c("rjson")
installed <- vapply(X = pkg, FUN = requireNamespace, FUN.VALUE = logical(1))
if (!all(installed)) {
  utils::install.packages(pkg[!installed])
}

## Get packages info
repo <- utils::contrib.url("https://tesselle.r-universe.dev")
pkg <- utils::available.packages(contriburl = repo)
pkg <- as.data.frame(pkg)

url <- sprintf("https://packages.tesselle.org/%s", pkg$Package)

## Build sitemap index
loc <- paste0(url, "/sitemap.xml")
map <- sprintf("  <sitemap>\n    <loc>%s</loc>\n  </sitemap>", loc)
cat(
  '<?xml version="1.0" encoding="UTF-8"?>',
  '<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">',
  '  <sitemap>',
  '    <loc>https://packages.tesselle.org/sitemap.xml</loc>',
  '  </sitemap>',
  map,
  '</sitemapindex>',
  file = "sitemapindex.xml",
  sep = "\n",
  append = FALSE
)

## Build search index
sea <- list()
for (i in seq_along(url)) {
  path <- url[[i]]
  tmp <- try(
    expr = rjson::fromJSON(file = paste0(path, "/search.json")), 
    silent = TRUE
  )
  if (!inherits(tmp, "try-error")) {
    for (j in seq_along(tmp)) {
      tmp[[j]]$path <- paste0(path, tmp[[j]]$path) # Absolute path
    }
    sea <- c(sea, tmp)
  }
}
writeLines(rjson::toJSON(sea), "search.json")
```

## Search the doc

<form role="search">
<input type="search" class="form-control" aria-label="Search" name="search-input" data-search-index="/search.json" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</form>

## Packages

```{r, echo=FALSE}
info <- pkg[order(pkg$Package), c("Package", "Version", "Depends", "License")]
url <- "<a href=\"https://packages.tesselle.org/%s\" title=\"Read the doc\">%s</a>"
info$Package <- sprintf(url, info$Package, info$Package)
rownames(info) <- NULL

knitr::kable(info, escape = FALSE)
```
