---
title: "R packages & archaeology"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

metathis::meta() |>
  metathis::meta_description(
    "A collection of R packages for research and teaching in archaeology."
  ) |> 
  metathis::meta_name("github-repo" = "tesselle/packages") |> 
  metathis::meta_viewport() |> 
  metathis::meta_social(
    title = "R packages & archaeology",
    url = "https://packages.tesselle.org/",
    image = "https://www.tesselle.org/images/tesselle.png",
    image_alt = "tesselle hex sticker",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@nfrerebeau"
  )

## Get packages info
repo <- utils::contrib.url("https://tesselle.r-universe.dev")
pkg <- utils::available.packages(contriburl = repo)
pkg <- as.data.frame(pkg)
url_pkg <- sprintf("https://packages.tesselle.org/%s", pkg$Package)

## Build sitemap index
loc <- paste0(url_pkg, "/sitemap.xml")
map <- sprintf("  <sitemap>\n    <loc>%s</loc>\n  </sitemap>", loc)
cat(
  '<?xml version="1.0" encoding="UTF-8"?>',
  '<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">',
  '  <sitemap>',
  '    <loc>https://packages.tesselle.org/sitemap.xml</loc>',
  '  </sitemap>',
  map,
  '</sitemapindex>',
  file = "sitemapindex.xml",
  sep = "\n",
  append = FALSE
)

## Build search index
sea <- list()
for (i in seq_along(url_pkg)) {
  path <- url_pkg[[i]]
  tmp <- try(
    expr = rjson::fromJSON(file = paste0(path, "/search.json")), 
    silent = TRUE
  )
  if (!inherits(tmp, "try-error")) {
    for (j in seq_along(tmp)) {
      tmp[[j]]$package <- pkg$Package[[i]]
    }
    sea <- c(sea, tmp)
  }
}
writeLines(rjson::toJSON(sea), "search.json")
```

[**tesselle**](https://www.tesselle.org/) is a collection of [R](https://www.r-project.org/) packages for research and teaching in archaeology. These packages focus on quantitative analysis methods developed for archaeology. The **tesselle** packages are designed to work seamlessly together and to complement general-purpose and other specialized statistical packages.

<form role="search">
<div class="form-group">
<label for="search-input">Search in the documentation</label>
<input type="search" class="form-control" aria-label="Search" name="search-input" data-search-index="/search.json" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
</form>

---

```{r}
url_doc <- "<a href=\"%s\" title=\"Read the doc\">%s</a>"
url_badge_version <- "<img src=\"http://www.r-pkg.org/badges/version/%s\">"
url_badge_status <- "<img src=\"https://cranchecks.info/badges/worst/%s\">"
url_badge_universe <- "<img src=\"https://tesselle.r-universe.dev/badges/%s\">"

az <- order(pkg$Package)
info <- pkg[az, c("Package", "Version", "Depends", "License")]
cran_version <- sprintf(url_badge_version, info$Package)
cran_status <- sprintf(url_badge_status, info$Package)
universe_version <- sprintf(url_badge_universe, info$Package)

data <- data.frame(
  Package = sprintf(url_doc, url_pkg[az], info$Package),
  version = cran_version,
  status = cran_status,
  universe = universe_version
)
knitr::kable(
  x = data, 
  row.names = FALSE, 
  col.names = c("Package", "CRAN version", "CRAN status", "R-universe"),
  escape = FALSE
)
```
